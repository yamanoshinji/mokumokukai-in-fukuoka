
# 勉強会記録：もくもく会in福岡支社

## 1. 概要
- 日付：2026/1/19/
- 内容：JavaオンプレシステムのAWS移行
- 参考記事：
  - [Qiita：【AWS】VPC・EC2 作成 ハンズオン](https://qiita.com/zeems/items/1d97d42a99936885ca4a)
  - [Qiita：手軽に学ぶ！初心者向けJavaアプリのAWSデプロイ方法。Eclipse、Tomcat、Apacheで始めるクラウド運用。](https://qiita.com/shuncask/items/779d8e92cc7af63aaa94)

## 2. 最終完成物
![alt text](image.png)

## 3. 作業概要
今回はコンソールでのポチポチ作業は最小限にし、**SSH接続後のターミナル操作（コマンドベース）**を中心に実施。

➀AWSネットワーク構築（インフラ基盤）
- VPC作成
- サブネット作成:
  - Public Subnet (WebAP用)
  - Private Subnet (DB用)
- ゲートウェイ設置:
  - インターネットゲートウェイ (IGW) を作成しVPCにアタッチ。
  - パブリックサブネットに NATゲートウェイ を作成←**料金が高かったらしい、注意**
- ルートテーブル設定:
  - Public用: 0.0.0.0/0 → IGW
  - Private用: 0.0.0.0/0 → NAT Gateway

➁セキュリティグループ (SG) の設定
- SG-Web: * Inbound: SSH(22) / HTTP(80) / Tomcat(8080) ← 自分のIPから許可
- SG-DB: * Inbound: PostgreSQL(5432) / SSH(22) ← SG-Web からの通信のみ許可（IP指定ではなくSG IDで指定）

➂Web/APサーバー構築（Public EC2）
- EC2 (Amazon Linux 2023) をPublic Subnetに起動。
- SSHで接続し、環境構築を実施。

➃DBサーバー構築（Private EC2 / PostgreSQL）
- EC2をPrivate Subnetに起動。
- 踏み台接続（SSHトンネリング/転送）:
  - ローカルPCから秘密鍵を使ってWebサーバーへSSH。
  - さらにWebサーバーからPrivate IPを指定してDBサーバーへSSH接続。
- PostgreSQL導入:
  - NAT経由でインターネットに出て dnf install postgresql15-server を実行。
  - DB初期化 (initdb) とサービス起動。
  - ユーザー作成とデータベース作成を実施。

- 接続許可設定
- pg_hba.conf を編集し、Webサーバーからの接続を受け入れる設定に変更。

➄アプリケーションデプロイ
- ローカルでビルドしたWARファイルをSCPでWebサーバーへ転送。
- アプリ内のDB接続設定（JDBC URL）を、Private EC2のIPアドレスに変更。
- Tomcatを再起動し、ブラウザから動作確認完了。

## 4. 学び
- クラウドだけの知識じゃ結構きつい、オンプレも勉強しないと環境構築むずかし
  - けど環境構築の勉強するのに、既存システムの導入はちょうどよかった
- ミスっても簡単にやり直しがきくのは勉強しやすい
- ベストプラクティスを考えたり調べたりするの大事
- CLI操作かっこいいけど慣れるまでくそだるい。しかもま
- 初心者でも生成AIさえあれば構築自体はいける
  - これに尽きる

## 5. 追加でやってみたいこと
- 今回はリホストだったけど、そのほかの移行パスもやってみたい
- IaCで環境を作りたい